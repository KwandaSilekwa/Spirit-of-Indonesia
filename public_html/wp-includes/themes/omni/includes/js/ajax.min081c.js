!function($){$(document).ready((function(){console.log("Ajax - v5.1");var ppp=$(".omni-search-form").attr("data-ppp"),post_type=$(".omni-search-form").attr("data-post_type"),pageno=$(".omni-search-form").attr("data-pageno"),orderby=$(".omni-search-form").attr("data-orderby"),perblock=$(".omni-search-form").attr("data-perblock");function initPageNumbers(){$(".page-numbers").on("click",(function(e){pagimeta="",pagimeta={relation:"AND"},e.preventDefault();var pageno=$(this).text();$(".omni-search-form ").attr("data-pageno",pageno),getPaginationArgs(pageno)}))}function createArgs(){var meta=new Object;$(".search-input").each((function(){var key=$(this).attr("data-key"),value=$(this).attr("data-selected-val"),id=$(this).attr("data-id"),input=$(this).attr("data-input");""==value?meta[key]={id:id,input:input,key:key,compare:"!=",value:""}:""!=value&&"checkbox"!=input?meta[key]={id:id,input:input,key:key,value:value}:""!=value&&"checkbox"==input&&(meta[key]={id:id,input:input,key:key,value:value,compare:"LIKE"})})),console.log(meta),updateResults(meta=JSON.stringify(meta)),console.table(meta)}function getPaginationArgs(pageno){var pagimeta=new Object,pageno=pageno;$(".search-input").each((function(){var key=$(this).attr("data-key"),value=$(this).attr("data-selected-val"),id=$(this).attr("data-id");""==value?pagimeta[key]={id:id,input:input,key:key,compare:"!=",value:""}:""!=value&&"checkbox"!=input?pagimeta[key]={id:id,input:input,key:key,value:value}:""!=value&&"checkbox"==input&&(pagimeta[key]={id:id,input:input,key:key,value:value,compare:"LIKE"})})),updatePagax(pagimeta=JSON.stringify(pagimeta),pageno)}function updateResults(meta){var qstr="ppp="+ppp+"&pageno=1&type="+post_type+"&meta="+meta+"&perblock="+perblock+"&orderby="+orderby+"&action=omni_load_results_ajax";return qstr.replace(/\s/g,""),console.log(qstr),$(".omni-loader").attr("data-display","yes"),$.ajax({type:"POST",dataType:"html",url:omni_ajax_script.ajaxurl,data:qstr,success:function(data){$(".slick-box").slick("unslick"),$(".output-row").empty(),$(".omni-search-form ").attr("data-pageno",1);var $data=$(data);$(".omni-loader").attr("data-display","no"),$(".output-row").append($data),omniSlickInit(),updateCount(),initPageNumbers()},error:function(jqXHR,textStatus,errorThrown){}}),!1}function updateCount(){var countstring=$("#result_count").attr("value"),countObject=JSON.parse(countstring),countArray=Object.entries(countObject),countKey=Object.keys(countObject),countValues=Object.values(countObject);console.log(countObject),console.log(countArray),console.log(countKey),console.log(countValues);for(var i=0;i<countKey.length;i++){var label=$('.search-input option[data-val="'+countValues[i].value+'"]').attr("data-title");$('.search-input option[data-val="'+countValues[i].value+'"]').text(label+" ("+countValues[i].count+")"),$('.search-input option[data-val="'+countValues[i].value+'"]').attr("data-count",countValues[i].count)}$(".search-input option.std").each((function(){var count;0==$(this).attr("data-count")?$(this).fadeOut():$(this).fadeIn(),updateTotals()}))}function updateTotals(){$("select.search-input").each((function(){var count=[],label=$(this).find("option.all").attr("data-title");$(this).find("option.std").each((function(){var thiscount=$(this).attr("data-count");count.push(parseInt(thiscount))}));var total=gettotal(count)}))}function gettotal(arr){return arr.reduce((function(a,b){return a+b}),0)}function updatePagax(pagimeta,pageno){var pagimeta=pagimeta,pageno=pageno;$(".omni-loader").attr("data-display","yes"),$(".omni-search-form ").attr("data-pageno",pageno);var qstr="ppp="+ppp+"&pageno="+pageno+"&type="+post_type+"&perblock="+perblock+"&meta="+pagimeta+"&orderby="+orderby+"&action=omniPajax";return qstr.replace(/\s/g,""),$.ajax({type:"POST",dataType:"html",url:omni_ajax_script.ajaxurl,data:qstr,success:function(data){$(".slick-box").slick("unslick"),$(".output-row").empty();var $data=$(data);$data.length&&($(".output-row").append($data),$(".omni-loader").attr("data-display","no")),omniSlickInit(),initPageNumbers()},error:function(jqXHR,textStatus,errorThrown){}}),!1}function slideUp(element){slideAllDown(),element.parents(".omni-item-bottom").toggleClass("open"),element.html('<i class="far fa-times-circle"></i>'),element.parents(".omni-item-bottom").attr("data-state","open")}function slideDown(element){element.parents(".omni-item-bottom").toggleClass("open"),element.html('<i class="far fa-chevron-circle-up"></i>'),element.parents(".omni-item-bottom").attr("data-state","closed")}function slideAllDown(){$(".slideup").each((function(){var element=$(this);"open"==element.parents(".omni-item-bottom").attr("data-state")&&(element.parents(".omni-item-bottom").toggleClass("open"),element.html('<i class="far fa-chevron-circle-up"></i>'),element.parents(".omni-item-bottom").attr("data-state","closed"))}))}function initButtons(){console.log("initbuttons"),$(".slideup").on("click",(function(){"closed"==$(this).parents(".omni-item-bottom").attr("data-state")?slideUp($(this)):slideDown($(this))})),$(".journeyreferer").each((function(){$(this).on("click",(function(e){var url=window.location.href,date,region,experience,thequery="?month_of_departure="+$('select[name="month_of_departure-select"]').val()+"&region="+$('select[name="region-select"]').val()+"&experiencetags="+$('select[name="experiencetags-select"]').val();Cookies.set("querystr",thequery),Cookies.set("referer",url)}))}))}function omniSlickInit(){$(".slick-box").slick({slidesToShow:1,slidesToScroll:1,dots:!0,arrows:!1,draggable:!0,customPaging:function(slider,i){return'<i class="fas fa-circle active-dot"></i><i class="far fa-circle inactive-dot "></i>'}}),$(".slicks>div").fadeIn(),initButtons()}function roomSlickInit(){$(".slick-box").slick({mobileFirst:!0,slidesToShow:1,slidesToScroll:1,dots:!1,arrows:!0,draggable:!0,adaptiveHeight:!0,prevArrow:$(".blog-slider.arrow.previous"),nextArrow:$(".blog-slider.arrow.next"),responsive:[{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:2}}]}),$(".img-slick-box").each((function(){var carousel;$(this).slick({slidesToShow:1,slidesToScroll:1,dots:!1,arrows:!0,prevArrow:'<button class="slide-arrow slick-prev" aria-label="Previous" type="button"><i class="fas fa-angle-left"></i></button>',nextArrow:'<button class="slide-arrow slick-next" aria-label="Next" type="button"><i class="fas fa-angle-right"></i></button>',draggable:!0})})),$(".slicks>div").fadeIn()}$("input[name=journeydates]").on("click",(function(){var departure_date=$("input[name=journeydates]:checked").val(),qstr="journeyid="+$("#room-data").attr("data-journeyid")+"&departuredate="+departure_date+"&action=getRoomsViewOutput";qstr.replace(/\s/g,""),console.log(qstr),$(".omni-loader").attr("data-display","yes"),$.ajax({type:"POST",dataType:"html",url:omni_ajax_script.ajaxurl,data:qstr,success:function(data){$(".slick-box").slick("unslick"),$(".img-slick-box").slick("unslick"),$(".rooms-output-row").empty(),console.log("yes data loaded"+data);var $data=$(data);$(".omni-loader").attr("data-display","no"),$(".rooms-output-row").append($data),roomSlickInit()},error:function(jqXHR,textStatus,errorThrown){console.log(errorThrown),console.log(textStatus),console.log(jqXHR)}})})),$(".search-input").on("change",(function(){var selected=$(this).children("option:selected").val();$(this).attr("data-selected-val",selected),createArgs()})),initButtons()}))}(jQuery);